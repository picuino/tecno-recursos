<!DOCTYPE html>
<html class="no-js" lang="en" >
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="keywords" content="Technology, Secondary Education, Drawing, Structures, Mechanisms, Materials, Electricity, Electronics, Computer Science, Programming, Control, Arduino, Communications, Workshop">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Libre educational resources for Technology in Secondary Education. Robótica - Sensors - 1. Ultrasonic distance sensor">
  <title>1. Ultrasonic distance sensor - Sensors - Picuino</title>

  
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96.png">
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png">

  
  <link rel="canonical" href="https://www.picuino.com/en/control-sensor-ultrasonic.html">

  
  <link rel="search" type="application/opensearchdescription+xml"
        title="Search within ..."
        href="_static/opensearch.xml">

  <link rel="stylesheet" href="_static/theme.css" type="text/css">
  <link rel="stylesheet" href="_static/pygments.css" type="text/css">
  <link rel="stylesheet" href="_static/custom.css" type="text/css">
  <link rel="glossary" title="Glossary" href="genindex.html">
  <link rel="index" title="Index" href="content.html">
  <link rel="search" title="Search" href="search.html">
  <link rel="next" title="2. Potentiometer" href="control-sensor-potentiometer.html">
  <link rel="prev" title="Sensors" href="control-sensor-index.html">

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    <div data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="content.html"><img src="_static/logo-picuino-bgblue.png" alt="O_[]¯O Picuino"></a>
      </nav>

	  <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="content.html">Home</a>/</li>
        
          <li><a href="robotica-index.html">Robótica</a>/</li>
        
          <li><a href="control-sensor-index.html">Sensors</a>/</li>
        
      <li><span class="section-number">1. </span>Ultrasonic distance sensor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/control-sensor-ultrasonic.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  

  
  <div style="background-color:#fdd; padding: 6px; margin:12px 0 12px 0">
  Attention: this page comes from an automatic translation of the original Spanish page.
  If you would like to collaborate, please
  <a href="contacto.html" target="_blank">contact</a> the author
  with the updated
  <a href="https://raw.githubusercontent.com/picuino/tecno-recursos/main/locale/en/LC_MESSAGES/control-sensor-ultrasonic.po" target="_blank">translation file</a>.
  </div>
  
  <hr>

</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sensor-de-distancia-por-ultrasonidos">
<h1><span class="section-number">1. </span>Ultrasonic distance sensor<a class="headerlink" href="#sensor-de-distancia-por-ultrasonidos" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="_images/img-0082.jpg"><img alt="Sensor de distancia por ultrasonidos SR04" class="align-center" src="_images/img-0082.jpg" style="width: 360px;"></a>
<div class="section" id="objetivos">
<h2>Goals<a class="headerlink" href="#objetivos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Understand the operation of the ultrasonic distance sensor.</li>
<li>Measure distances with an ultrasonic distance sensor.</li>
</ul>
</div>
<div class="section" id="el-sensor-de-ultrasonidos">
<h2>Ultrasonic sensor<a class="headerlink" href="#el-sensor-de-ultrasonidos" title="Permalink to this headline">¶</a></h2>
<p>This sensor has a small speaker that beeps and a sensor microphone that detects the beep. The device calculates the time it takes for sound to travel to an object and return reflected. The distance from the sensor to the object is calculated from the speed of sound in air and the time it takes for sound to travel that distance.</p>
<p>The emitted beep has a frequency of 40kHz. This frequency is well above 20kHz, which is the highest frequency that humans can perceive. For this reason, this high frequency sound is called ultrasound.</p>
<p>There are several sensor models on the market, the best known and most affordable are the SR04 model and the more advanced version SRF05. In this tutorial the SR04 model is explained. The explanation is valid for more advanced models, taking into account that these have greater capacity or added features.</p>
</div>
<div class="section" id="caracteristicas-del-sensor-sr04">
<h2>SR04 Sensor Characteristics<a class="headerlink" href="#caracteristicas-del-sensor-sr04" title="Permalink to this headline">¶</a></h2>
<p>This ultrasonic sensor has the following characteristics:</p>
<blockquote>
<div><ul class="simple">
<li>Sensing distance: 2cm - 400cm</li>
<li>Resolution: 0.3cm</li>
<li>Sound frequency: 40kHz</li>
<li>Effective angle: 15º</li>
<li>Supply voltage: 5V</li>
<li>Current Consumption: 15mA</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="libreria-para-sensores-de-ultrasonidos">
<h2>Library for ultrasonic sensors<a class="headerlink" href="#libreria-para-sensores-de-ultrasonidos" title="Permalink to this headline">¶</a></h2>
<p>To handle ultrasonic sensors there are several working libraries. The most accurate standard library that can be used is <a class="reference external" href="https://playground.arduino.cc/Code/NewPing" rel="noopener noreferrer" target="_blank">NewPing</a>. To install the library, follow these steps:</p>
<ol class="arabic simple">
<li>Download the library</li>
<li>Save the file NewPing_v1.9.4.zip on the computer</li>
<li>Open the Arduino graphical environment</li>
<li>In the Sketch tab.. Import library.. click 'Add Library...'</li>
<li>Find the downloaded file and after selecting it, press 'Open'</li>
<li>Check that in the Sketch tab.. Import library.. a new library called NewPing appears</li>
</ol>
<p>With these steps the library will be correctly installed.</p>
</div>
<div class="section" id="medicion-de-distancias">
<h2>Distance measurement<a class="headerlink" href="#medicion-de-distancias" title="Permalink to this headline">¶</a></h2>
<p>To measure distances with the SR04 sensor, the following steps will be followed:</p>
<ol class="arabic">
<li><p class="first">Connect the SR04 sensor to the Arduino board according to the following scheme:</p>
<a class="reference internal image-reference" href="_images/img-0009.png"><img alt="Conexión Arduino-SR04" class="align-center" src="_images/img-0009.png" style="width: 600px;"></a>
</li>
<li><p class="first">Copy the following program, compile it and download it to the Arduino board.</p>
<div class="highlight-Arduino notranslate" id="ultrasonic-prog1"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Medición de distancias por ultrasonidos.</span>
<span class="c1">// Método basado en la velocidad del sonido.</span>

<span class="cp">#include</span> <span class="cpf">&lt;NewPing.h&gt;</span><span class="cp"></span>

<span class="cp">#define TRIGGER_PIN    4     </span><span class="c1">// Pin de Arduino conectado a la patilla Trigger, en el sensor de ultrasonidos.</span>
<span class="cp">#define ECHO_PIN       2     </span><span class="c1">// Pin de Arduino conectado a la patilla Echo, en el sensor de ultrasonidos.</span>
<span class="cp">#define MAX_DISTANCE 200     </span><span class="c1">// Distancia máxima que podrá medir el sensor.</span>
                             <span class="c1">// Esta distancia puede llegar a valer 400cm</span>
<span class="cp">#define SOUND_SPEED 0.171    </span><span class="c1">// La mitad de la velocidad del sonido en el aire, medida en [mm/us]</span>

<span class="n">NewPing</span> <span class="nf">sonar</span><span class="p">(</span><span class="n">TRIGGER_PIN</span><span class="p">,</span> <span class="n">ECHO_PIN</span><span class="p">,</span> <span class="n">MAX_DISTANCE</span><span class="p">);</span> <span class="c1">// Configuración de la librería NewPing</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>     <span class="c1">// Abre las comunicaciones serie entre Arduino y el ordenador</span>
<span class="p">}</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
   <span class="kr">int</span> <span class="n">microseconds</span><span class="p">;</span>                <span class="c1">// Tiempo que tarda el sonido del sensor en rebotar y volver</span>
   <span class="kr">int</span> <span class="n">distance</span><span class="p">;</span>                    <span class="c1">// Distancia al obstáculo en centímetros</span>

   <span class="nf">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                       <span class="c1">// Espera 50 milisegundos entre dos ping consecutivos.</span>
                                    <span class="c1">// Este tiempo evita errores producidos por el eco.</span>
   <span class="n">microseconds</span> <span class="o">=</span> <span class="n">sonar</span><span class="p">.</span><span class="n">ping</span><span class="p">();</span>     <span class="c1">// Mide el tiempo que tarda el sonido en rebotar</span>
   <span class="n">distance</span> <span class="o">=</span> <span class="n">microseconds</span> <span class="o">*</span> <span class="n">SOUND_SPEED</span><span class="p">;</span> <span class="c1">// Calcula la distancia al objeto en milímetros</span>

   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Ping: &quot;</span><span class="p">);</span>          <span class="c1">// Envía al ordenador un mensaje con la distancia medida</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">microseconds</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;us</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">distance</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Open the serial monitor (Serial Monitor) by clicking the icon that appears at the top right in the Arduino graphical environment.</p>
<img alt="Botón del monitor serie" class="align-center" src="_images/img-0010.png">
</li>
<li><p class="first">In the new window that appears, choose the transmission speed in the box that appears at the bottom right. In this case, the programmed speed is 115200 bauds.</p>
<p>The chart should continuously display time and distance information.</p>
<img alt="Monitor serie" class="align-center" src="_images/img-0012.png">
</li>
</ol>
<p>At this point, if all went well, the Arduino will be continuously measuring the distance between the sensor and the objects placed in front of it. This distance is sent to the computer through the serial port (through the USB cable) to display it on the screen.</p>
</div>
<div class="section" id="ajuste-del-sensor">
<h2>Sensor adjustment<a class="headerlink" href="#ajuste-del-sensor" title="Permalink to this headline">¶</a></h2>
<p>Sensor adjustment allows measurements to be more accurate. In order to adjust the sensor, it is necessary to correct multiple parameters that can influence the measurement. The speed of sound in air, atmospheric pressure, the speed of the sensor's internal timer, etc. To avoid the complexity of adjusting all these parameters one by one, an adjustment called two-point adjustment is going to be carried out.</p>
<p>First, a measurement must be made at a known distance, close to the sensor. Then another measurement must be made at a known distance, further from the sensor.</p>
<p>The first measurement can correct what is called a zero adjustment. The second measurement is used to perform the ramp adjustment. The measurements must be entered in a table such as the following:</p>
<blockquote>
<div><table class="docutils align-default" id="id1">
<caption><span class="caption-text">Table 1.</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
</colgroup>
<thead style="vertical-align:bottom;">
<tr class="row-odd"><th class="head">Extent</th>
<th class="head">Time</th>
<th class="head">Distance</th>
</tr>
</thead>
<tbody style="vertical-align:top;">
<tr class="row-even"><td>Measure 1</td>
<td>247us</td>
<td>50mm</td>
</tr>
<tr class="row-odd"><td>Measure 2</td>
<td>1123us</td>
<td>200mm</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>From this table, a better fit of the measurement can be made with the Arduino command <a class="reference external" href="https://www.Arduino.cc/reference/en/language/functions/math/map/" rel="noopener noreferrer" target="_blank">map()</a> :</p>
<blockquote>
<div>distance = map(microseconds, 247, 1123, 50, 200);</div></blockquote>
<p>The first argument is the time measurement performed by the sensor. The next two arguments are the bounce times to the near and far object. The next two arguments are the distances of the near and far object.</p>
<p>The modified program is as follows.</p>
<div class="highlight-Arduino notranslate" id="ultrasonic-prog2"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Medición de distancias por ultrasonidos.</span>
<span class="c1">// Método basado en el ajuste de dos puntos.</span>

<span class="cp">#include</span> <span class="cpf">&lt;NewPing.h&gt;</span><span class="cp"></span>

<span class="cp">#define TRIGGER_PIN    4   </span><span class="c1">// Pin de Arduino conectado a la patilla Trigger, en el sensor de ultrasonidos.</span>
<span class="cp">#define ECHO_PIN       2   </span><span class="c1">// Pin de Arduino conectado a la patilla Echo, en el sensor de ultrasonidos.</span>
<span class="cp">#define MAX_DISTANCE 200   </span><span class="c1">// Distancia máxima que podrá medir el sensor.</span>
                           <span class="c1">// Esta distancia puede llegar a valer 400cm</span>

<span class="kr">const</span> <span class="kr">int</span> <span class="n">time1</span> <span class="o">=</span> <span class="mi">247</span><span class="p">;</span>     <span class="c1">// Tiempo, en microsegundos, del ping al objeto cercano</span>
<span class="kr">const</span> <span class="kr">int</span> <span class="n">distance1</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>  <span class="c1">// Distancia, en milímetros, al objeto cercano</span>
<span class="kr">const</span> <span class="kr">int</span> <span class="n">time2</span> <span class="o">=</span> <span class="mi">1123</span><span class="p">;</span>    <span class="c1">// Tiempo, en microsegundos, del ping al objeto lejano</span>
<span class="kr">const</span> <span class="kr">int</span> <span class="n">distance2</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="c1">// Distancia, en milímetros, al objeto lejano</span>

<span class="n">NewPing</span> <span class="nf">sonar</span><span class="p">(</span><span class="n">TRIGGER_PIN</span><span class="p">,</span> <span class="n">ECHO_PIN</span><span class="p">,</span> <span class="n">MAX_DISTANCE</span><span class="p">);</span> <span class="c1">// Configuración de la librería NewPing</span>

<span class="kr">int</span> <span class="n">microseconds</span><span class="p">;</span>             <span class="c1">// Tiempo que tarda el sonido del sensor en rebotar y volver</span>
<span class="kr">int</span> <span class="n">distance</span><span class="p">;</span>                 <span class="c1">// Distancia al obstáculo en centímetros</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>   <span class="c1">// Abre las comunicaciones serie entre Arduino y el ordenador</span>
<span class="p">}</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>                    <span class="c1">// Espera 50 milisegundos entre dos ping consecutivos.</span>
                                 <span class="c1">// Este tiempo evita errores producidos por el eco.</span>
   <span class="n">microseconds</span> <span class="o">=</span> <span class="n">sonar</span><span class="p">.</span><span class="n">ping</span><span class="p">();</span>  <span class="c1">// Mide el tiempo que tarda el sonido en rebotar</span>

   <span class="c1">// Calcula con precisión la distancia al objeto en milímetros</span>
   <span class="n">distance</span> <span class="o">=</span> <span class="nf">map</span><span class="p">(</span><span class="n">microseconds</span><span class="p">,</span> <span class="n">time1</span><span class="p">,</span> <span class="n">time2</span><span class="p">,</span> <span class="n">distance1</span><span class="p">,</span> <span class="n">distance2</span><span class="p">);</span>

   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Ping: &quot;</span><span class="p">);</span>       <span class="c1">// Envía al ordenador un mensaje con la distancia medida</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">microseconds</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;us</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">distance</span><span class="p">);</span>
   <span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="s">&quot;mm&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="ejercicios">
<h2>Exercises<a class="headerlink" href="#ejercicios" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Perform measurements for two-point adjustment with a specific sensor. Modify the <a class="reference internal" href="uno-doc/ultrasonic.html#ultrasonic-prog2"><span class="std std-ref">previous program</span></a> to get the sensor to return exact measurements with its own measurements.</p>
<p>Each sensor will give different values ​​for the 4 numbers in table 1, depending on the altitude at which we are, the temperature and other sensor parameters.</p>
</li>
<li><p class="first">Show the measured distance on the 7-segment display with the following program.</p>
<div class="highlight-Arduino notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Medición de distancias por ultrasonidos.</span>
<span class="c1">// Mostrar el valor de distancia en display de 7 segmentos.</span>

<span class="cp">#include</span> <span class="cpf">&lt;Wire.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;PC42.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;NewPing.h&gt;</span><span class="cp"></span>

<span class="cp">#define TRIGGER_PIN    4  </span><span class="c1">// Pin de Arduino conectado a la patilla Trigger, en el sensor de ultrasonidos.</span>
<span class="cp">#define ECHO_PIN       2  </span><span class="c1">// Pin de Arduino conectado a la patilla Echo, en el sensor de ultrasonidos.</span>
<span class="cp">#define MAX_DISTANCE 200  </span><span class="c1">// Distancia máxima que podrá medir el sensor.</span>
                          <span class="c1">// Esta distancia puede llegar a valer 400cm</span>
<span class="cp">#define SOUND_SPEED 0.171    </span><span class="c1">// La mitad de la velocidad del sonido en el aire, medida en [mm/us]</span>

<span class="n">NewPing</span> <span class="nf">sonar</span><span class="p">(</span><span class="n">TRIGGER_PIN</span><span class="p">,</span> <span class="n">ECHO_PIN</span><span class="p">,</span> <span class="n">MAX_DISTANCE</span><span class="p">);</span> <span class="c1">// Configuración de la librería NewPing</span>

<span class="kr">int</span> <span class="n">distance</span><span class="p">,</span> <span class="n">microseconds</span><span class="p">;</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">pc</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span>            <span class="c1">// Inicializar el módulo PC42</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>             <span class="c1">// Esperar 50 milisegundos entre dos ping consecutivos.</span>
                          <span class="c1">// Este tiempo evita errores producidos por el eco.</span>

   <span class="n">microseconds</span> <span class="o">=</span> <span class="n">sonar</span><span class="p">.</span><span class="n">ping</span><span class="p">();</span> <span class="c1">// Medir el tiempo que tarda el sonido en rebotar</span>

   <span class="n">distance</span> <span class="o">=</span> <span class="n">microseconds</span> <span class="o">*</span> <span class="n">SOUND_SPEED</span><span class="p">;</span> <span class="c1">// Calcular la distancia al objeto en milímetros</span>

   <span class="n">pc</span><span class="p">.</span><span class="n">dispWrite</span><span class="p">(</span><span class="n">distance</span><span class="p">);</span>      <span class="c1">// Mostrar la distancia en el display de 7 segmentos</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
<li><p class="first">Turn on a bar of LEDs that represents the distance of an object from the ultrasonic sensor. Complete the program so that the bar occupies 6 leds.</p>
<div class="highlight-Arduino notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Medición de distancias por ultrasonidos.</span>
<span class="c1">// Mostrar el valor de distancia en display de 7 segmentos.</span>

<span class="cp">#include</span> <span class="cpf">&lt;Wire.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;PC42.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;NewPing.h&gt;</span><span class="cp"></span>

<span class="cp">#define TRIGGER_PIN    4   </span><span class="c1">// Pin de Arduino conectado a la patilla Trigger, en el sensor de ultrasonidos.</span>
<span class="cp">#define ECHO_PIN       2   </span><span class="c1">// Pin de Arduino conectado a la patilla Echo, en el sensor de ultrasonidos.</span>
<span class="cp">#define MAX_DISTANCE 200   </span><span class="c1">// Distancia máxima que podrá medir el sensor.</span>
                           <span class="c1">// Esta distancia puede llegar a valer 400cm</span>
<span class="cp">#define SOUND_SPEED 0.171  </span><span class="c1">// La mitad de la velocidad del sonido en el aire, medida en [mm/us]</span>

<span class="n">NewPing</span> <span class="nf">sonar</span><span class="p">(</span><span class="n">TRIGGER_PIN</span><span class="p">,</span> <span class="n">ECHO_PIN</span><span class="p">,</span> <span class="n">MAX_DISTANCE</span><span class="p">);</span> <span class="c1">// Configuración de la librería NewPing</span>

<span class="kr">int</span> <span class="n">microseconds</span><span class="p">;</span>         <span class="c1">// Tiempo que tarda el sonido del sensor en rebotar y volver</span>
<span class="kr">int</span> <span class="n">distance</span><span class="p">;</span>             <span class="c1">// Distancia al obstaculo en centímetros</span>

<span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">pc</span><span class="p">.</span><span class="nf">begin</span><span class="p">();</span>            <span class="c1">// Inicializar el módulo PC42</span>
<span class="p">};</span>

<span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>             <span class="c1">// Esperar 50 milisegundos entre dos ping consecutivos.</span>
                          <span class="c1">// Este tiempo evita errores producidos por el eco.</span>

   <span class="n">microseconds</span> <span class="o">=</span> <span class="n">sonar</span><span class="p">.</span><span class="n">ping</span><span class="p">();</span>           <span class="c1">// Medir el tiempo que tarda el sonido en rebotar</span>

   <span class="n">distance</span> <span class="o">=</span> <span class="n">microseconds</span> <span class="o">*</span> <span class="n">SOUND_SPEED</span><span class="p">;</span> <span class="c1">// Calcular la distancia al objeto en milímetros</span>

   <span class="c1">// Encender el led 1 si la distancia es mayor de 40mm</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">)</span>
      <span class="n">pc</span><span class="p">.</span><span class="n">ledWrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LED_ON</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="n">pc</span><span class="p">.</span><span class="n">ledWrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LED_OFF</span><span class="p">);</span>

   <span class="c1">// Encender el led 2 si la distancia es mayor de 80mm</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">)</span>
      <span class="n">pc</span><span class="p">.</span><span class="n">ledWrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LED_ON</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="n">pc</span><span class="p">.</span><span class="n">ledWrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LED_OFF</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>

  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="control-sensor-potentiometer.html" class="btn btn-neutral float-right" title="2. Potentiometer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="control-sensor-index.html" class="btn btn-neutral" title="Sensors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <ul class="link-list">
    <li><a href="contacto.html" target="_blank">Contact</a></li>
    <li><a href="manifiesto.html" target="_blank">Manifest</a></li>
    <li><a href="../es/legal-aviso.html" target="_blank">Terms Of Service</a></li>
    <li><a href="legal-cookies.html" target="_blank">Cookie policy</a></li>
    <li><a href="legal-attribution.html" target="_blank">Credits</a></li>
    <li><a href="genindex.html" target="_blank">Glossary</a></li>
    <li><a href="content.html" target="_blank">Index</a></li>
    </ul>
    <p class="content-info">
      Copyright &copy; 2013-2025, Carlos Félix Pardo Martín.
      <br>

      Contents under <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank">CC BY-SA 4.0 license</a>
      and computer programs under <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">GPL v3 license</a>
      unless otherwise specified.
      <br>
      <span class="lastupdated">
        Last updated on January, 2025.
      </span>

    </p>
  </div> 

</footer>


          

        </div>
      </div>

    </div>


    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo-picuino-bgblue.png" class="logo" alt="O_[]¯O Picuino">
          
          </a>
          <br>
          <a href="../es/control-sensor-ultrasonic.html">Español</a>
          <br>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dibujo-index.html">Technical drawing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mecan-index.html">Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="material-index.html">Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="electric-index.html">Electricity</a></li>
<li class="toctree-l1"><a class="reference internal" href="electronic-index.html">Electronics</a></li>
<li class="toctree-l1"><a class="reference internal" href="informatica-index.html">Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="prog-index.html">Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="arduprog/index.html">Arduino</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="robotica-index.html">Robótica</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="control-index.html">System control</a></li>
<li class="toctree-l2"><a class="reference internal" href="control-actuator-index.html">Actuators</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="control-sensor-index.html">Sensors</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">1. Ultrasonic distance sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="control-sensor-potentiometer.html">2. Potentiometer</a></li>
<li class="toctree-l3"><a class="reference internal" href="control-sensor-temp.html">3. Temperature sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="control-sensor-dht11.html">4. DHT11 temperature and humidity sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="control-sensor-light.html">5. Light sensors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="robotica-normativa.html">Normativa Código Escuela 4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="robotica-recursos.html">Recursos para Robótica</a></li>
<li class="toctree-l2"><a class="reference internal" href="robotica-robots-actuales.html">Robots actuales</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="comm-index.html">Communications</a></li>
<li class="toctree-l1"><a class="reference internal" href="taller-index.html">Technology Workshop</a></li>
<li class="toctree-l1"><a class="reference internal" href="recursos-index.html">Another resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="ley-index.html">Educational Legislation</a></li>
</ul>

            
          

          <!-- Enlaces directos -->
          <br>
          <ul>
          <li class="toctree-l1"><a class="reference internal"
          href="https://www.picuino.com/es/manifiesto.html">Manifiesto</a>
          </li><li class="toctree-l1"><a class="reference internal"
          href="https://www.picuino.com/test/">Technology Test</a>
          </li><li class="toctree-l1"><a class="reference internal"
          href="https://www.picuino.com/circuits/">Circuits simulator</a>
          </li><li class="toctree-l1"><a class="reference internal"
          href="https://github.com/picuino/tecno-recursos">Project in GitHub</a>
          </li>
          </ul>
        </div>
      </div>
    </nav>

  </div>
  


  

    
    
      <script defer id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    

   

  <script defer src="_static/theme.js"></script>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

</body>
</html>